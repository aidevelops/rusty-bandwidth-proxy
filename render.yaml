services:
  - type: web
    name: rusty-bandwidth
    env: rust
    plan: free
    buildCommand: |
      apt-get update
# Needed dependencies
apt-get install -y \
  git cmake ninja-build clang lld \
  libbrotli-dev libpng-dev libjpeg-dev libwebp-dev pkg-config
# Build JPEG XL from source
git clone https://github.com/libjxl/libjxl.git
cd libjxl
git checkout v0.11.1
cmake -B build -GNinja \
  -DCMAKE_BUILD_TYPE=Release \
  -DJPEGXL_ENABLE_PLUGINS=OFF \
  -DJPEGXL_ENABLE_EXAMPLES=OFF \
  -DJPEGXL_ENABLE_TOOLS=OFF \
  -DJPEGXL_ENABLE_MANPAGES=OFF
ninja -C build
ninja -C build install
# Back to project folder
cd ..
# Now build Rusty Bandwidth
cargo build --release
startCommand: ./target/release/rusty-bandwidth
autoDeploy: true
